# name: Backend CI/CD

# on:
#   push:
#     branches: [ main ]
#   pull_request:
#     branches: [ main ]

# jobs:
#   ci:
#     name: CI — Lint & Tests
#     runs-on: ubuntu-latest
#     steps:
#       - name: Checkout
#         uses: actions/checkout@v4

#       - name: Set up Python
#         uses: actions/setup-python@v4
#         with:
#           python-version: '3.11'

#       - name: Cache pip
#         uses: actions/cache@v4
#         with:
#           path: ~/.cache/pip
#           key: ${{ runner.os }}-pip-${{ hashFiles('backend/requirements.txt') }}

#       - name: Install dependencies
#         run: |
#           python -m pip install --upgrade pip
#           pip install -r backend/requirements.txt

#       - name: Lint (ruff)
#         run: |
#           pip install ruff
#           ruff check backend || true

#       - name: Run tests (pytest)
#         run: |
#           pip install pytest
#           pytest -q

#   deploy:
#     name: Deploy to server
#     needs: ci
#     if: github.ref == 'refs/heads/main'
#     runs-on: ubuntu-latest
#     steps:
#       - name: Checkout
#         uses: actions/checkout@v4

#       - name: Deploy via SSH
#         uses: appleboy/ssh-action@master
#         with:
#           host: ${{ secrets.SERVER_HOST }}
#           username: ${{ secrets.SERVER_USERNAME }}
#           key: ${{ secrets.SERVER_SSH_KEY }}
#           port: ${{ secrets.SERVER_SSH_PORT }}
#           script: |
#             set -e
#             cd /home/ENRICH/
#             git stash --quiet || true
#             git pull origin main
#             # Activate virtualenv if you use one (example):
#             # source venv/bin/activate
#             # Install any new deps if required:
#             # pip install -r requirements.txt
#             # Run migrations if applicable
#             # alembic upgrade head || true
#             # Restart the service (adjust service name to your setup):
#             sudo systemctl restart enrich || echo "service restart failed"
#             echo "✅ Deployment finished"